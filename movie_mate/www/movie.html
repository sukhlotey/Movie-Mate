{% extends 'templates/web.html' %}

{% block page_content %}
<div class="container-wrapper">
    {% if title %}
    <div class="movie-page">
        <div class="movie-poster">
            <img src="{{ poster_image or '/files/placeholder.jpg' }}" alt="{{ title }}" class="rounded-lg shadow-lg">
        </div>
        <div class="movie-details">
            <h1 class="text-4xl font-bold mb-4">{{ title }}</h1>
            <p class="text-lg text-gray-600 mb-2">Genre: {{ genre or 'N/A' }}</p>
            <p class="text-lg mb-2">Release Year: <span class="font-semibold">{{ release_year or 'N/A' }}</span></p>
            <p class="text-lg mb-2">IMDB: <span class="font-semibold">{{ imdb_rating or 'N/A' }}</span></p>
            <p class="text-lg mb-2">Director: <span class="font-semibold">{{ director or 'N/A' }}</span></p>
            <p class="text-lg mb-2">Country: <span class="font-semibold">{{ country or 'N/A' }}</span></p>
            <p class="text-lg mb-2">Status: <span class="font-semibold">{{ status or 'N/A' }}</span></p>
            <p class="mt-4 text-gray-800">{{ description or 'No description available' }}</p>
            <p class="mt-4">Average Rating: <span class="font-semibold">{{ average_rating or 'No ratings yet' }}</span></p>
            {% if frappe.session.user != 'Guest' %}
            <div class="mt-6">
                <h4 class="text-xl font-semibold mb-2">Rate this Movie</h4>
                <select id="rating" class="rating-select">
                    <option value="" selected disabled>Select Rating</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
                <button class="rating-button" onclick="submit_rating('{{ name }}')">Submit Rating</button>
            </div>
            {% else %}
            <p class="mt-4"><a href="/login" class="text-blue-600 hover:underline">Log in</a> to rate this movie.</p>
            {% endif %}
        </div>
    </div>
    {% else %}
        <p>Movie not found.</p>
    {% endif %}
</div>

<script>
function submit_rating(movie_name) {
    let rating = document.getElementById('rating').value;
    if (!rating) {
        frappe.msgprint('Please select a rating.');
        return;
    }
    frappe.call({
        method: 'movie_mate.api.submit_rating',
        args: {
            movie: movie_name,
            rating: rating
        },
        callback: function(r) {
            if (r.message) {
                frappe.msgprint('Rating submitted successfully!');
                location.reload();
            }
        }
    });
}
</script>
{% endblock %}
